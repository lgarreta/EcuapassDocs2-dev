{% extends "base_page.html" %}
{% load crispy_forms_tags %}

{% block content %}
<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>

<div class="container"> 
    <h2>Ingreso</h2>
	<form id="login" method="POST", action="">
        {% csrf_token %}
        <!-- Display the authentication form -->
        {{ form|crispy }}
        <!-- Display the country selection form -->
		{{ country_form|crispy }}	
        <button id="submit" class="btn btn-primary" type="submit">Ingreso</button>
    </form>
</div>
<script>
	// Script showing the user's "pais" 
	$('#id_username').on('blur', function() {
		var username = $(this).val();
		$.ajax({
		    url      : "{% url 'get_country_for_username' %}",  // URL for the AJAX view
		    data     : { 'username': username },
		    dataType : 'json',
		    success  : function(data) {
				$('#id_pais').html('');
				if (data.pais) 
					$('#id_pais').append('<option value="' + data.pais + '">' + data.pais + '</option>');
				else 
					$('#id_pais').append('<option value="">No country found</option>');
				}
		});
});
		
</script>

{% endblock %}
    
